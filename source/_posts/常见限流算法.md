---
title: 常见限流算法
tags: [算法, Java]
categories: 算法教程
date:  2023/03/01 17:29
---
常见限流算法
===================

## 类型
### 计数器算法
#### 固定窗口计数器
###### 步骤
* 时间线划分为多个独立且固定大小的窗口
* 落到每一个时间窗口的请求就将计数器加1
* 如果计数器超过了限流值，后续请求落到该时间窗口都会被拒绝
* 当时间达到下一个时间窗口时，计数器将会被重置为0
###### 缺陷
* 临界点问题：例如59秒时打满100个请求，60秒重置又打满100个请求，就相当与1秒内来了200个请求
* 资源浪费：我们希望100个请求可以均匀的分布到这一分钟内，但如果提前达到请求上限，剩余时间服务器就闲置了
#### 滑动窗口计算器 
###### 步骤
* 将单位时间划分为多个区间，一般都是均分为多个小的时间段
* 每一个区间都有一个计数器，有请求落到该区间该区间计数器就加1
* 每个一个时间段，时间窗口就会向右滑动一格，抛弃最老的一个区间，纳入新的一个区间
* 计算整个时间窗口内的请求总数时会累计所有的时间片段内的计数器，当总和超过了限制数，就会拒绝接收请求
###### 缺陷
* 时间区间的精度越高，算法所需的空间容量就越大
### 漏桶算法
###### 步骤
* 将每个请求放入固定大小的队列进行存储
* 队列以固定速率向外流出请求，如果队列为空则停止流出
* 如果队列满了则将多余的请求会被直接拒绝
###### 缺陷
* 当短时间内有大量的突发请求时，即时服务器负载不高，每个请求也会在队列中等待一段时间才能被响应，并发量不够
### 令牌桶算法
* 以固定速率生成令牌并放入令牌桶中
* 如果令牌桶满了则多余的令牌会直接丢弃
* 当请求到达时，会尝试从令牌桶中取令牌，取到令牌的请求可以执行
* 如果令牌桶空了，则拒绝该请求
###### 实现
* 限流工具类RateLimiter Guava提供的限流工具类基于令牌桶

#### 令牌桶与漏桶 
###### 总结起来：如果要让自己的系统不被打垮，用令牌桶。如果保证别人的系统不被打垮，用漏桶算法

